{"filter":false,"title":"wiki.go","tooltip":"/wiki.go","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":51,"column":5},"end":{"row":51,"column":6},"action":"remove","lines":["6"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":4},"end":{"row":51,"column":5},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":5},"end":{"row":50,"column":6},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":4},"end":{"row":50,"column":5},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":5},"end":{"row":49,"column":6},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":4},"end":{"row":49,"column":5},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":5},"end":{"row":48,"column":6},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":4},"end":{"row":48,"column":5},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":5},"end":{"row":47,"column":6},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":4},"end":{"row":47,"column":5},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":46,"column":5},"end":{"row":46,"column":6},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":46,"column":4},"end":{"row":46,"column":5},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":5},"end":{"row":45,"column":6},"action":"remove","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":4},"end":{"row":45,"column":5},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":5},"end":{"row":44,"column":6},"action":"remove","lines":["9"]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":4},"end":{"row":44,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":5},"end":{"row":43,"column":6},"action":"remove","lines":["8"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":4},"end":{"row":43,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":5},"end":{"row":42,"column":6},"action":"remove","lines":["7"]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":4},"end":{"row":42,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":5},"end":{"row":41,"column":6},"action":"remove","lines":["6"]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":4},"end":{"row":41,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":5},"end":{"row":40,"column":6},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":4},"end":{"row":40,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":5},"end":{"row":39,"column":6},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":4},"end":{"row":39,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":5},"end":{"row":38,"column":6},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":4},"end":{"row":38,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":5},"end":{"row":37,"column":6},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":4},"end":{"row":37,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":5},"end":{"row":36,"column":6},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":4},"end":{"row":36,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":35,"column":5},"end":{"row":35,"column":6},"action":"remove","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":35,"column":4},"end":{"row":35,"column":5},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":34,"column":5},"end":{"row":34,"column":6},"action":"remove","lines":["9"]}]}],[{"group":"doc","deltas":[{"start":{"row":34,"column":4},"end":{"row":34,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":5},"end":{"row":33,"column":6},"action":"remove","lines":["8"]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":4},"end":{"row":33,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":32,"column":5},"end":{"row":32,"column":6},"action":"remove","lines":["7"]}]}],[{"group":"doc","deltas":[{"start":{"row":32,"column":4},"end":{"row":32,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":5},"end":{"row":31,"column":6},"action":"remove","lines":["6"]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":4},"end":{"row":31,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":30,"column":5},"end":{"row":30,"column":6},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":30,"column":4},"end":{"row":30,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":5},"end":{"row":29,"column":6},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":4},"end":{"row":29,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":5},"end":{"row":28,"column":6},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":4},"end":{"row":28,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":5},"end":{"row":27,"column":6},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":4},"end":{"row":27,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":26,"column":5},"end":{"row":26,"column":6},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":26,"column":4},"end":{"row":26,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":25,"column":5},"end":{"row":25,"column":6},"action":"remove","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":25,"column":4},"end":{"row":25,"column":5},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":24,"column":5},"end":{"row":24,"column":6},"action":"remove","lines":["9"]}]}],[{"group":"doc","deltas":[{"start":{"row":24,"column":4},"end":{"row":24,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":5},"end":{"row":23,"column":6},"action":"remove","lines":["8"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":4},"end":{"row":23,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":22,"column":4},"end":{"row":22,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":22,"column":4},"end":{"row":22,"column":5},"action":"remove","lines":["7"]}]}],[{"group":"doc","deltas":[{"start":{"row":21,"column":5},"end":{"row":21,"column":6},"action":"remove","lines":["6"]}]}],[{"group":"doc","deltas":[{"start":{"row":21,"column":4},"end":{"row":21,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":5},"end":{"row":20,"column":6},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":4},"end":{"row":20,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":5},"end":{"row":19,"column":6},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":4},"end":{"row":19,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":5},"end":{"row":18,"column":6},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":4},"end":{"row":18,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":5},"end":{"row":17,"column":6},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":4},"end":{"row":17,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":5},"end":{"row":16,"column":6},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":4},"end":{"row":16,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":5},"end":{"row":15,"column":6},"action":"remove","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":4},"end":{"row":15,"column":5},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":5},"end":{"row":14,"column":6},"action":"remove","lines":["9"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":4},"end":{"row":14,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":5},"end":{"row":13,"column":6},"action":"remove","lines":["8"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":4},"end":{"row":13,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":5},"end":{"row":12,"column":6},"action":"remove","lines":["7"]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":4},"end":{"row":12,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":5},"end":{"row":11,"column":6},"action":"remove","lines":["6"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":4},"end":{"row":11,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":5},"end":{"row":10,"column":6},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":4},"end":{"row":10,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":5},"end":{"row":9,"column":6},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":4},"end":{"row":9,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":5},"end":{"row":7,"column":6},"action":"remove","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":4},"end":{"row":7,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":0},"end":{"row":7,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":5},"end":{"row":5,"column":6},"action":"remove","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":4},"end":{"row":5,"column":5},"action":"remove","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":5},"end":{"row":4,"column":6},"action":"remove","lines":["9"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":5},"end":{"row":3,"column":6},"action":"remove","lines":["8"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":5},"end":{"row":2,"column":6},"action":"remove","lines":["7"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":5},"end":{"row":1,"column":6},"action":"remove","lines":["6"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":109,"column":0},"action":"remove","lines":["package main","     \t","     \timport (","     \t\t\"flag\"","     \t\t\"html/template\"","    \t\t\"io/ioutil\"","    \t\t\"log\"","\t\t\"net\"","    \t\t\"net/http\"","    \t\t\"regexp\"","    \t)","    \t","    \tvar (","    \t\taddr = flag.Bool(\"addr\", false, \"find open address and print to final-port.txt\")","    \t)","    \t","    \ttype Page struct {","    \t\tTitle string","    \t\tBody  []byte","    \t}","    \t","    \tfunc (p *Page) save() error {","    \t\tfilename := p.Title + \".txt\"","    \t\treturn ioutil.WriteFile(filename, p.Body, 0600)","    \t}","    \t","    \tfunc loadPage(title string) (*Page, error) {","    \t\tfilename := title + \".txt\"","    \t\tbody, err := ioutil.ReadFile(filename)","    \t\tif err != nil {","    \t\t\treturn nil, err","    \t\t}","    \t\treturn &Page{Title: title, Body: body}, nil","    \t}","    \t","    \tfunc viewHandler(w http.ResponseWriter, r *http.Request, title string) {","    \t\tp, err := loadPage(title)","    \t\tif err != nil {","    \t\t\thttp.Redirect(w, r, \"/edit/\"+title, http.StatusFound)","    \t\t\treturn","    \t\t}","    \t\trenderTemplate(w, \"view\", p)","    \t}","    \t","    \tfunc editHandler(w http.ResponseWriter, r *http.Request, title string) {","    \t\tp, err := loadPage(title)","    \t\tif err != nil {","    \t\t\tp = &Page{Title: title}","    \t\t}","    \t\trenderTemplate(w, \"edit\", p)","    \t}","    \t","    \tfunc saveHandler(w http.ResponseWriter, r *http.Request, title string) {","    \t\tbody := r.FormValue(\"body\")","    \t\tp := &Page{Title: title, Body: []byte(body)}","    \t\terr := p.save()","    \t\tif err != nil {","    \t\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)","    \t\t\treturn","    \t\t}","    \t\thttp.Redirect(w, r, \"/view/\"+title, http.StatusFound)","    \t}","    \t","    \tvar templates = template.Must(template.ParseFiles(\"edit.html\", \"view.html\"))","    \t","    \tfunc renderTemplate(w http.ResponseWriter, tmpl string, p *Page) {","    \t\terr := templates.ExecuteTemplate(w, tmpl+\".html\", p)","    \t\tif err != nil {","    \t\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)","    \t\t}","    \t}","    \t","    \tvar validPath = regexp.MustCompile(\"^/(edit|save|view)/([a-zA-Z0-9]+)$\")","    \t","    \tfunc makeHandler(fn func(http.ResponseWriter, *http.Request, string)) http.HandlerFunc {","    \t\treturn func(w http.ResponseWriter, r *http.Request) {","    \t\t\tm := validPath.FindStringSubmatch(r.URL.Path)","    \t\t\tif m == nil {","    \t\t\t\thttp.NotFound(w, r)","    \t\t\t\treturn","    \t\t\t}","    \t\t\tfn(w, r, m[2])","    \t\t}","    \t}","    \t","    \tfunc main() {","    \t\tflag.Parse()","    \t\thttp.HandleFunc(\"/view/\", makeHandler(viewHandler))","    \t\thttp.HandleFunc(\"/edit/\", makeHandler(editHandler))","    \t\thttp.HandleFunc(\"/save/\", makeHandler(saveHandler))","    \t","    \t\tif *addr {","    \t\t\tl, err := net.Listen(\"tcp\", \"127.0.0.1:0\")","    \t\t\tif err != nil {","    \t\t\t\tlog.Fatal(err)","   \t\t\t}","   \t\t\terr = ioutil.WriteFile(\"final-port.txt\", []byte(l.Addr().String()), 0644)","   \t\t\tif err != nil {","   \t\t\t\tlog.Fatal(err)","   \t\t\t}","   \t\t\ts := &http.Server{}","   \t\t\ts.Serve(l)","   \t\t\treturn","   \t\t}","   \t","   \t\thttp.ListenAndServe(\":8080\", nil)","   \t}","   \t","",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":107,"column":0},"action":"insert","lines":["package main","","import (","\t\"flag\"","\t\"html/template\"","\t\"io/ioutil\"","\t\"log\"","\t\"net\"","\t\"net/http\"","\t\"regexp\"",")","","var (","\taddr = flag.Bool(\"addr\", false, \"find open address and print to final-port.txt\")",")","","type Page struct {","\tTitle string","\tBody  []byte","}","","func (p *Page) save() error {","\tfilename := p.Title + \".txt\"","\treturn ioutil.WriteFile(filename, p.Body, 0600)","}","","func loadPage(title string) (*Page, error) {","\tfilename := title + \".txt\"","\tbody, err := ioutil.ReadFile(filename)","\tif err != nil {","\t\treturn nil, err","\t}","\treturn &Page{Title: title, Body: body}, nil","}","","func viewHandler(w http.ResponseWriter, r *http.Request, title string) {","\tp, err := loadPage(title)","\tif err != nil {","\t\thttp.Redirect(w, r, \"/edit/\"+title, http.StatusFound)","\t\treturn","\t}","\trenderTemplate(w, \"view\", p)","}","","func editHandler(w http.ResponseWriter, r *http.Request, title string) {","\tp, err := loadPage(title)","\tif err != nil {","\t\tp = &Page{Title: title}","\t}","\trenderTemplate(w, \"edit\", p)","}","","func saveHandler(w http.ResponseWriter, r *http.Request, title string) {","\tbody := r.FormValue(\"body\")","\tp := &Page{Title: title, Body: []byte(body)}","\terr := p.save()","\tif err != nil {","\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)","\t\treturn","\t}","\thttp.Redirect(w, r, \"/view/\"+title, http.StatusFound)","}","","var templates = template.Must(template.ParseFiles(\"edit.html\", \"view.html\"))","","func renderTemplate(w http.ResponseWriter, tmpl string, p *Page) {","\terr := templates.ExecuteTemplate(w, tmpl+\".html\", p)","\tif err != nil {","\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)","\t}","}","","var validPath = regexp.MustCompile(\"^/(edit|save|view)/([a-zA-Z0-9]+)$\")","","func makeHandler(fn func(http.ResponseWriter, *http.Request, string)) http.HandlerFunc {","\treturn func(w http.ResponseWriter, r *http.Request) {","\t\tm := validPath.FindStringSubmatch(r.URL.Path)","\t\tif m == nil {","\t\t\thttp.NotFound(w, r)","\t\t\treturn","\t\t}","\t\tfn(w, r, m[2])","\t}","}","","func main() {","\tflag.Parse()","\thttp.HandleFunc(\"/view/\", makeHandler(viewHandler))","\thttp.HandleFunc(\"/edit/\", makeHandler(editHandler))","\thttp.HandleFunc(\"/save/\", makeHandler(saveHandler))","","\tif *addr {","\t\tl, err := net.Listen(\"tcp\", \"127.0.0.1:0\")","\t\tif err != nil {","\t\t\tlog.Fatal(err)","\t\t}","\t\terr = ioutil.WriteFile(\"final-port.txt\", []byte(l.Addr().String()), 0644)","\t\tif err != nil {","\t\t\tlog.Fatal(err)","\t\t}","\t\ts := &http.Server{}","\t\ts.Serve(l)","\t\treturn","\t}","","\thttp.ListenAndServe(\":8080\", nil)","}",""]}]}]]},"ace":{"folds":[],"scrolltop":1495,"scrollleft":0,"selection":{"start":{"row":99,"column":3},"end":{"row":99,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":86,"state":"start","mode":"ace/mode/golang"}},"timestamp":1424812035783,"hash":"318ff764e7f2572f4a6f232b7ffc22c9faa5430c"}